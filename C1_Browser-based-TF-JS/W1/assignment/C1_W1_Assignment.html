<script lang="js">
    async function run() {
        const trainingUrl = '/data/wdbc-train.csv';
        
        // Mengatur kolom label (misalnya 'diagnosis')
        const trainingData = tf.data.csv(trainingUrl, {
            columnConfigs: {
                diagnosis: {isLabel: true} // Diagnosis adalah label
            }
        });

        // Konversi data menjadi array tensor
        const convertedTrainingData = trainingData.map(({xs, ys}) => {
            return {xs: Object.values(xs), ys: Object.values(ys)[0]}; 
        }).batch(32);

        const testingUrl = '/data/wdbc-test.csv';

        const testingData = tf.data.csv(testingUrl, {
            columnConfigs: {
                diagnosis: {isLabel: true}
            }
        });

        const convertedTestingData = testingData.map(({xs, ys}) => {
            return {xs: Object.values(xs), ys: Object.values(ys)[0]};
        }).batch(32);

        // Jumlah fitur berdasarkan dataset (misalnya ada 30 kolom fitur)
        const numOfFeatures = 30; // Ganti dengan jumlah fitur yang tepat pada data Anda

        // Neural Network dengan Dense Layers
        const model = tf.sequential();
        model.add(tf.layers.dense({
            inputShape: [numOfFeatures], 
            units: 16, 
            activation: 'relu'
        }));
        model.add(tf.layers.dense({units: 8, activation: 'relu'}));
        model.add(tf.layers.dense({units: 1, activation: 'sigmoid'})); // Output untuk klasifikasi biner

        // Compile model
        model.compile({
            optimizer: 'rmsprop',
            loss: 'binaryCrossentropy',
            metrics: ['accuracy']
        });

        // Melatih model
        await model.fitDataset(convertedTrainingData, {
            epochs: 100,
            validationData: convertedTestingData,
            callbacks: {
                onEpochEnd: async (epoch, logs) => {
                    console.log("Epoch: " + epoch + " Loss: " + logs.loss + " Accuracy: " + logs.acc);
                }
            }
        });

        // Menyimpan model
        await model.save('downloads://my_model');
    }
    run();
</script>
